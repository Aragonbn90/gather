import { Injectable, HttpException, HttpStatus, Logger } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { FindManyOptions, FindOneOptions } from 'typeorm';
import { WalmartDTO } from '../service/dto/walmart.dto';
import { WalmartMapper } from '../service/mapper/walmart.mapper';
import { WalmartRepository } from '../repository/walmart.repository';
import { Walmart } from '../domain/walmart.entity';
import { v4 as uuid } from 'uuid';
import { FileService } from './file.service';
import { HttpService } from '@nestjs/axios';

const relationshipNames = [];
const RETAILER = 'Walmart';

@Injectable()
export class WalmartService {

  logger = new Logger('WalmartService');

  constructor(
    @InjectRepository(WalmartRepository) private walmartRepository: WalmartRepository,
    private fileService: FileService,
    private httpService: HttpService,
  ) { }

  async one(url: string): Promise<WalmartDTO> {
    //gather product
    const body = { "operationName": "GetProduct", "variables": { "itemId": "199544994", "selected": true, "fulfillmentIntent": "", "p13N": { "reqId": "3ca7f473-71ba-4ef1-a02d-40d6a709623f", "modules": [{ "moduleType": "PersonalizedLabels", "moduleId": "234-sdfsfvns-sdfdskvl" }], "userReqInfo": { "refererContext": { "query": "beef", "facet": "", "catId": "", "source": "itempage" }, "bstc": "test_sid", "pageUrl": "/ip/Beef-Carne-Para-Deshebrar-1-22-2-22-lb/199544994" }, "userClientInfo": { "deviceType": "ANDROID", "callType": "CLIENT", "isZipLocated": true }, "pageId": "199544994" }, "channel": "Mobile", "pageType": "MobileItemscreenGlobal", "tenant": "WM_GLASS", "p13nCls": { "pageId": "199544994", "userClientInfo": { "callType": "CLIENT", "deviceType": "ANDROID" }, "userReqInfo": { "bstc": "test_sid", "vid": "5e138803-a6f5-4a59-8059-b2decd53dd75" } }, "variantFieldId": "actual_color", "tempo": { "targeting": "{\"deviceType\":\"android\",\"deviceVersion\":\"21.27\",\"userState\":\"loggedOut\"}" }, "version": "v1", "layout": ["mobile-item"], "virtualTryOnParams": null }, "query": "query GetProduct($itemId: String!, $selected: Boolean, $semStoreId: Int, $catalogSellerId: String, $fulfillmentIntent:String, $p13N: P13NRequest, $channel: String!, $pageType: String!, $tenant: String!, $p13nCls: JSON, $variantFieldId: String, $tempo: JSON, $version: String!, $layout: [String], $page: Int, $sort: String, $limit: Int, $filters: [String], $virtualTryOnParams: JSON) { product(itemId: $itemId, selected: $selected, semStoreId: $semStoreId, catalogSellerId: $catalogSellerId, fulfillmentIntent: $fulfillmentIntent, p13N: $p13N, variantFieldId: $variantFieldId) { __typename ...FullProductFragment } contentLayout(channel: $channel, pageType: $pageType, tenant: $tenant, version: $version) { __typename modules(p13n: $p13nCls, tempo: $tempo, virtualTryOnParams: $virtualTryOnParams) { __typename name type version status schedule { __typename start end priority expEnabled } triggers { __typename pageType pageId zone inheritable } configs { __typename ... on _TempoWM_GLASSMobileNutritionValuePlaceholderConfigs { _rawConfigs } ... on _TempoWM_GLASSMobileProductDescriptionPlaceholderConfigs { _rawConfigs } ... on _TempoWM_GLASSMobileReviewsPlaceholderConfigs { _rawConfigs } ... on TempoWM_GLASSMobileZeekitConfigs { zeekit { __typename ... ZeekitFragment } } ... blitz ... buyboxAd ... capitalOneBanner ... itemCarousel ... itemFitmentWidget ... marqueeDisplayAd ... skylineDisplayAd ... sponsoredProductCarouselAd ... walmartPlusBanner ... walmartPlusDuringEventBanner ... walmartPlusPreEventBanner ... capitalOneBannerV1 ... enricher ... itemCarouselV1 ... walmartPlusBannerV1 ... walmartPlusDuringEventBannerV1 ... walmartPlusPreEventBannerV1 } publishedDate moduleId matchedTrigger { __typename pageType pageId zone inheritable } } layouts(layout: $layout) { __typename id layout } pageMetadata { __typename location { __typename stateOrProvinceCode postalCode storeId incatchment } pageContext } } idml(itemId: $itemId, html: true) { __typename ...IDMLFragment } reviews(itemId: $itemId, page: $page, limit: $limit, sort: $sort, filters: $filters) { __typename ...ProductReviewsFragment } ugcUserInfo { __typename userNickname userId } } fragment FullProductFragment on Product { __typename usItemId id primaryUsItemId suppressReviews walmartItemNumber primaryProductId snapEligible fsaEligibleInd giftingEligibility segment type name semStoreData { __typename deliveryStoreId pickupStoreId isSemLocationDifferent } location { __typename postalCode stateOrProvinceCode city storeIds } productLocation { __typename displayValue aisle { __typename zone aisle section } } promoData { __typename ...ProductPromotionFragment } shortDescription detailedDescription manufacturerName averageRating numberOfReviews classType fulfillmentBadge category { __typename ...ProductCategoryFragment } upc itemType configuration typeId rhPath primaryShelf maximumSoldByWeight averageSoldByWeight salesUnitType isAlcohol merchandiseCommerceNumber brand manufacturerProductId productTypeId viscosity tireSize tireSpeedRating tireLoadIndex aaiaBrandId canonicalUrl primaryShelfId pricePerUnitQuantity classId departmentName orderLimit orderMinLimit variantCriteria { __typename id name type categoryType categoryTypeAllValues variantList { __typename ...VariantListFragment } } variants { __typename ...MinimalProductFragment } imageInfo { __typename ...ProductImageInfoFragment } priceInfo { __typename priceRange { __typename ...ProductPriceRangeFragment } priceDisplayCodes { __typename ...PriceDisplayCodesFragment } currentPrice { __typename ...ProductPriceFragment } wasPrice { __typename ...ProductPriceFragment } unitPrice { __typename ...ProductPriceFragment } subscriptionPrice { __typename priceString subscriptionString } savings { __typename ...ProductSavingsFragment } } pickupOption { __typename slaTier accessTypes availabilityStatus } shippingOption { __typename slaTier accessTypes availabilityStatus deliveryDate maxDeliveryDate shipPrice { __typename priceString } } offerId fulfillmentType fulfillmentTitle fulfillmentLabel { __typename wPlusFulfillmentText message shippingText fulfillmentText locationText fulfillmentType fulfillmentMethod addressEligibility postalCode checkStoreAvailability } buyNowEligible preOrder { __typename streetDate streetDateDisplayable streetDateType isPreOrder preOrderMessage preOrderStreetDateMessage } availabilityStatus checkAvailabilityGlobalDFS checkStoreAvailabilityATC shipAsIs offerType sellerId returnPolicy { __typename returnable freeReturns returnWindow { __typename value unitType } returnPolicyText } ironbankCategory catalogSellerId sellerName sellerDisplayName wfsEnabled hasSellerBadge additionalOfferCount secondaryOfferPrice { __typename currentPrice { __typename priceString } } sellerType sellerReviewCount sellerAverageRating weightIncrement sponsoredProduct { __typename spQs clickBeacon spTags } shippingRestriction showFulfillmentLink badges { __typename ...badgesFragment } groupMetaData { __typename ...GroupMetaDataFragment } showAddOnServices addOnServices { __typename ...AddOnServiceFragment } showBuyWithWplus isEarlyAccessItem earlyAccessEvent blitzItem ozarkAttributes { __typename shippingPromise exactAddress } legalRestriction zeekitData { __typename ...ZeekitFragment } } fragment ProductPromotionFragment on ProductPromotion { __typename templateData { __typename priceString imageUrl } terms type } fragment ProductCategoryFragment on ProductCategory { __typename categoryPathId categoryPath path { __typename name url } } fragment MinimalProductFragment on Variant { __typename usItemId productId availabilityStatus fulfillmentBadge imageInfo { __typename ...ProductImageInfoFragment } priceInfo { __typename priceRange { __typename ...ProductPriceRangeFragment } priceDisplayCodes { __typename ...PriceDisplayCodesFragment } currentPrice { __typename ...ProductPriceFragment } wasPrice { __typename ...ProductPriceFragment } unitPrice { __typename ...ProductPriceFragment } savings { __typename ...ProductSavingsFragment } } } fragment ProductImageInfoFragment on ProductImageInfo { __typename allImages { __typename id url zoomable } thumbnailUrl } fragment ProductPriceRangeFragment on ProductPriceRange { __typename minPrice maxPrice priceString unitOfMeasure currencyUnit denominations { __typename ...GiftCardDenominationFragment } } fragment GiftCardDenominationFragment on GiftCardDenomination { __typename price priceString selected } fragment PriceDisplayCodesFragment on PriceDisplayCodes { __typename submapType clearance reducedPrice rollback hidePriceForSOI strikethrough priceDisplayCondition unitPriceDisplayCondition eligibleForAssociateDiscount finalCostByWeight pricePerUnitUom } fragment ProductPriceFragment on ProductPrice { __typename price priceString priceType currencyUnit variantPriceString } fragment ProductSavingsFragment on ProductSavings { __typename priceString } fragment badgesFragment on UnifiedBadge { __typename flags { __typename ...badgeInterfaceFragment } tags { __typename ...badgeInterfaceFragment } labels { __typename ...badgeInterfaceFragment } } fragment badgeInterfaceFragment on BadgeInterface { __typename ... on BaseBadge { id key rank text type query } ... on PreviouslyPurchasedBadge { id key rank text lastBoughtOn numBought criteria { __typename name value } } } fragment GroupMetaDataFragment on GroupMetaData { __typename groupComponents { __typename ...BundleGroupComponentFragment } } fragment BundleGroupComponentFragment on BundleGroupComponent { __typename quantity offerId productDisplayName } fragment AddOnServiceFragment on AddOnService { __typename serviceType serviceTitle serviceSubTitle groups { __typename ...AddOnServiceGroupFragment } } fragment AddOnServiceGroupFragment on AddOnServiceGroup { __typename groupType groupTitle assetUrl shortDescription services { __typename ...AddOnServiceDataFragment } } fragment AddOnServiceDataFragment on AddOnServiceData { __typename name displayName selectedDisplayName productId usItemId sellerId offerId usSellerId currentPrice { __typename ...ProductPriceFragment } duration manufacturerName serviceMetaData } fragment ZeekitFragment on ZeekitEntity { __typename abstractProductId color zeekit { __typename isProductEnabledInZeekit numberOfSimulatedImages simulatedImages { __typename id url zoomable } personaDetails { __typename id size height firstName lastName bust waist hips inseam } } } fragment VariantListFragment on VariantList { __typename id name categoryId swatchImageUrl products images availabilityStatus rank selected } fragment IDMLFragment on Idml { __typename warnings { __typename attribute name value } specifications { __typename name value } rxPharmacy { __typename name value } indications { __typename name value } supplementFacts { __typename headers { __typename name value } footers { __typename name value } segments { __typename name amount dvp } } chokingHazards { __typename headline message } directions { __typename name value } displayabilityMatrix { __typename researchTabModuleKey showAboutAlbumHeader showMarketingContent showVideoContent } drugFacts { __typename activeIngredients { __typename name values { __typename name purpose } } inactiveIngredients { __typename name value } directions { __typename name values { __typename name value } } warnings { __typename name values { __typename name value } } question { __typename name value } otherInformation { __typename name value } } esrbRating indications { __typename name value } ingredients { __typename activeIngredients { __typename name value } inactiveIngredients { __typename name value } ingredients { __typename name value } } legalBadges { __typename ...LegalContentFragment } longDescription shortDescription mpaaRating nutritionFacts { __typename calorieInfo { __typename ...NutritionAttributeFragment } keyNutrients { __typename name values { __typename ...NutritionAttributeFragment } } servingInfo { __typename name values { __typename name value } } staticContent { __typename name value } vitaminMinerals { __typename ...NutritionAttributeFragment } additionalDisclaimer { __typename name value } } sizeCharts { __typename id tagDisplay } warranty { __typename information length } videos { __typename poster title versions { __typename large small } } videoMatrix { __typename usItemId videoModulesKey videoModulesType } product360ImageContainer { __typename name url } productHighlights { __typename name value } } fragment LegalContentFragment on LegalContent { __typename ageRestriction headline image mature message } fragment NutritionAttributeFragment on NutritionAttribute { __typename name mainNutrient { __typename ...NutrientFragment } childNutrients { __typename ...NutrientFragment } } fragment NutrientFragment on Nutrient { __typename amount dvp name childNutrients { __typename ...NutrientFragment2 } } fragment NutrientFragment2 on Nutrient { __typename amount dvp name } fragment ProductReviewsFragment on ProductReviews { __typename activePage activeSort averageOverallRating customerReviews { __typename ...CustomerReviewsFragment } topPositiveReview { __typename ...CustomerReviewsFragment } topNegativeReview { __typename ...CustomerReviewsFragment } overallRatingRange percentageOneCount percentageTwoCount percentageThreeCount percentageFourCount percentageFiveCount ratingValueOneCount ratingValueTwoCount ratingValueThreeCount ratingValueFourCount ratingValueFiveCount recommendedPercentage roundedAverageOverallRating totalReviewCount pagination { __typename ...PaginationFragment } } fragment CustomerReviewsFragment on CustomerReview { __typename authorId badges { __typename badgeType contentType glassBadge { __typename id text } id } userLocation negativeFeedback positiveFeedback rating recommended reviewId reviewSubmissionTime reviewText reviewTitle showRecommended syndicationSource { __typename contentLink logoImageUrl name } userNickname externalSource photos { __typename caption id sizes { __typename normal { __typename ...ReviewPhotoSizeFragment } thumbnail { __typename ...ReviewPhotoSizeFragment } } } } fragment ReviewPhotoSizeFragment on ReviewPhotoSize { __typename id url } fragment PaginationFragment on Pagination { __typename currentSpan next { __typename num url active gap } pages { __typename num url active gap } previous { __typename num url active gap } total } fragment blitz on TempoWM_GLASSMobileBlitzConfigs { __typename inStoreBlitzMessageEndTimeEST inStoreBlitzMessageStartTimeEST inStoreBlitzMessageText1 inStoreBlitzMessageText2 inStoreBlitzMessageText3 onlineBlitzMessageEndTimeEST onlineBlitzMessageStartTimeEST onlineBlitzMessageText1 onlineBlitzMessageText2 onlineBlitzMessageText3 pulses { __typename pulseMessageEndTimeEST pulseMessageStartTimeEST pulseMessageLine1 pulseMessageLine2 } } fragment buyboxAd on TempoWM_GLASSMobileBuyBoxAdConfigs { __typename buyboxModuleLocation: moduleLocation ad { __typename adContent { __typename data { __typename ... on DisplayAd { json status } ... on SponsoredProducts { adUuid adExpInfo moduleInfo debug products { __typename ...product } } } type } adRequestComposite adsContext moduleConfigs moduleType pageContext pageId pageType platform stateCode storeId tenant zipCode } } fragment capitalOneBanner on TempoWM_GLASSMobileCapitalOneBannerConfigs { __typename bannerBackgroundColor primaryImage { __typename alt src } bannerText { __typename text textColor isBold } bannerCta { __typename textColor ctaLink { __typename title clickThrough { __typename type value } } } cardLayout } fragment itemCarousel on TempoWM_GLASSMobileItemCarouselConfigs { __typename productsConfig { __typename products { __typename ...product } } subTitle tileOptions { __typename ...tileOptions } title type viewAllLink { __typename title clickThrough { __typename type value } } spBeaconInfo { __typename adUuid moduleInfo pageViewUUID placement max } } fragment itemFitmentWidget on TempoWM_GLASSMobileItemFitmentModuleConfigs { __typename fitment { __typename ...ContentLayoutFitmentFragment } } fragment marqueeDisplayAd on TempoWM_GLASSMobileMarqueeDisplayAdConfigs { __typename ad { __typename adContent { __typename data { __typename ... on DisplayAd { json } } type } adsContext pageId pageType } enableLazyLoad moduleLocation } fragment skylineDisplayAd on TempoWM_GLASSMobileSkylineDisplayAdConfigs { __typename ad { __typename adContent { __typename data { __typename ... on DisplayAd { json status } } type } adsContext moduleType moduleConfigs platform pageId pageType pageContext status storeId stateCode zipCode } enableLazyLoad rawConfig: _rawConfigs } fragment sponsoredProductCarouselAd on TempoWM_GLASSMobileSponsoredProductCarouselConfigs { __typename title sponsoredProductsModuleLocation: moduleLocation enableAdLazyLoading ad { __typename adContent { __typename data { __typename ... on DisplayAd { html json status } ... on SponsoredBrands { adExpInfo adUuid brands { __typename logo { __typename featuredHeadline featuredImage featuredImageName featuredUrl logoClickTrackUrl } products { __typename ...product } } moduleInfo } ... on SponsoredProducts { adExpInfo adUuid debug moduleInfo products { __typename ...product } } } type } adRequestComposite adsContext moduleConfigs moduleType pageContext pageId pageType platform stateCode status storeId tenant zipCode } } fragment walmartPlusBanner on TempoWM_GLASSMobileWalmartPlusBannerConfigs { __typename heading disclaimer ctaLink { __typename title clickThrough { __typename type value } } } fragment walmartPlusDuringEventBanner on TempoWM_GLASSMobileWalmartPlusEarlyAccessDuringEventConfigs { __typename dealsBackground earlyAccessCardMesssage earlyAccessCounterLabel earlyAccessendTime earlyAccessSubText earlyAccessLink1 { __typename clickThrough { __typename type value } title } earlyAccessLink2 { __typename clickThrough { __typename type value } title } earlyAccessLogo { __typename alt src } earlyAccessstartTime earlyAccesssunsetTime earlyAccessTitle } fragment walmartPlusPreEventBanner on TempoWM_GLASSMobileWalmartPlusEarlyAccessBeforeEventConfigs { __typename dealsBackground dealsDisclaimer dealsSubtext1 dealsSubtext2 earlyAccessCardMesssage earlyAccessLink1 { __typename clickThrough { __typename type value } title } earlyAccessLink2 { __typename clickThrough { __typename type value } title } earlyAccessLogo { __typename alt src } earlyAccessTitle } fragment capitalOneBannerV1 on TempoWM_GLASSMobileCapitalOneBannerConfigsV1 { __typename bannerBackgroundColor primaryImage { __typename alt src } bannerText { __typename text textColor isBold } bannerCta { __typename textColor ctaLink { __typename title clickThrough { __typename type value } } } cardLayout } fragment enricher on EnricherModuleConfigsV1 { __typename zoneV1 } fragment itemCarouselV1 on TempoWM_GLASSMobileItemCarouselConfigsV1 { __typename productsConfig { __typename products { __typename ...productV1 } } subTitle tileOptions { __typename ...tileOptions } title type viewAllLink { __typename title clickThrough { __typename type value } } spBeaconInfo { __typename adUuid moduleInfo pageViewUUID placement max } } fragment walmartPlusBannerV1 on TempoWM_GLASSMobileWalmartPlusBannerConfigsV1 { __typename heading disclaimer ctaLink { __typename title clickThrough { __typename type value } } } fragment walmartPlusDuringEventBannerV1 on TempoWM_GLASSMobileWalmartPlusEarlyAccessDuringEventConfigsV1 { __typename dealsBackground dealsLayout earlyAccessLogo { __typename alt src } earlyAccessTitle earlyAccessCardMesssage earlyAccessCounterLabel earlyAccessstartTime earlyAccessendTime earlyAccesssunsetTime earlyAccessSubText earlyAccessLink1 { __typename title clickThrough { __typename type value } } earlyAccessLink2 { __typename clickThrough { __typename type value } title } } fragment walmartPlusPreEventBannerV1 on TempoWM_GLASSMobileWalmartPlusEarlyAccessBeforeEventConfigsV1 { __typename dealsBackground dealsDisclaimer dealsLayoutType : dealsLayout dealsSubtext1 dealsSubtext2 earlyAccessLogo { __typename alt src } earlyAccessTitle earlyAccessCardMesssage earlyAccessLink1 { __typename title clickThrough { __typename type value } } earlyAccessLink2 { __typename title clickThrough { __typename type value } } } fragment product on Product { __typename availabilityStatus averageRating badges { __typename ...badgesFragment } canonicalUrl classType departmentName fulfillmentBadge id imageInfo { __typename thumbnailUrl } mediaRating name numberOfReviews offerId orderLimit orderMinLimit p13nData { __typename flags { __typename ...productFlagsLabels } labels { __typename ...productFlagsLabels } predictedQuantity seeSimilarLinkEnabled } preOrder { __typename isPreOrder preOrderMessage preOrderStreetDateMessage } priceInfo { __typename priceDisplayCodes { __typename clearance finalCostByWeight priceDisplayCondition rollback } currentPrice { __typename price priceString } wasPrice { __typename price priceString } unitPrice { __typename price priceString } priceRange { __typename minPrice maxPrice priceString unitOfMeasure } shipPrice { __typename price priceString } } salesUnit sponsoredProduct { __typename clickBeacon spQs spTags } showAtc showOptions type usItemId variantCount variantCriteria { __typename name variantList { __typename swatchImageUrl } } weightIncrement } fragment productFlagsLabels on P13NDataFlagsLabels { __typename PREVIOUSLY_PURCHASED { __typename text } CUSTOMERS_PICK { __typename text } } fragment tileOptions on TempoWM_GLASSMobileCommonTileOptions { __typename addToCart averageRatings displayAveragePriceCondition displayPricePerUnit displayStandardPrice displayWasPrice fulfillmentBadging mediaRatings productFlags productLabels productPrice productTitle productTitleLineCount hideSimilarText seeSimilarText } fragment ContentLayoutFitmentFragment on Fitment { __typename partTypeID partTypeIDs result { __typename notes position formId quantityTitle status labels { __typename ...fitmentlabels } suggestions { __typename id cat_id labels { __typename ...fitmentlabels } fitmentSuggestionParams { __typename id value } } extendedAttributes { __typename ...fitmentfields } } labels { __typename ...fitmentlabels } savedVehicle { __typename vehicleYear { __typename ...fitmentvehiclefields } vehicleMake { __typename ...fitmentvehiclefields } vehicleModel { __typename ...fitmentvehiclefields } additionalAttributes { __typename ...fitmentvehiclefields } } } fragment fitmentlabels on FitmentLabels { __typename links { __typename id label } messages { __typename id label } ctas { __typename id label } images { __typename id label } } fragment fitmentfields on FitmentField { __typename id value displayName data { __typename label value } extended dependsOn } fragment fitmentvehiclefields on FitmentVehicleField { __typename id value label } fragment productV1 on Product { __typename availabilityStatus averageRating badges { __typename ...badgesFragment } canonicalUrl classType departmentName fulfillmentBadge id imageInfo { __typename thumbnailUrl } mediaRating name numberOfReviews offerId orderLimit orderMinLimit p13nData: p13nDataV1 { __typename flags { __typename ...productFlagsLabels } labels { __typename ...productFlagsLabels } predictedQuantity seeSimilarLinkEnabled } preOrder { __typename isPreOrder preOrderMessage preOrderStreetDateMessage } priceInfo { __typename priceDisplayCodes { __typename clearance finalCostByWeight priceDisplayCondition rollback } currentPrice { __typename price priceString } wasPrice { __typename price priceString } unitPrice { __typename price priceString } priceRange { __typename minPrice maxPrice priceString unitOfMeasure } shipPrice { __typename price priceString } } salesUnit sponsoredProduct { __typename clickBeacon spQs spTags } showAtc showOptions type usItemId variantCount variantCriteria { __typename name variantList { __typename swatchImageUrl } } weightIncrement }" };

    const headers = {
      'X-APOLLO-OPERATION-ID': '992fb62dbb65f749f4ead29eb2962cdf05a5c10dcba817a524e4e3e922449b20',
      'X-APOLLO-OPERATION-NAME': 'GetProduct',
      'WM_CONSUMER.ID': 'c52ce16a-df55-43ee-ba7c-4c24fdb3bb05',
      'X-APOLLO-CACHE-KEY': 'be70fd0f8c7608bb64a809fd389e667f',
      'X-APOLLO-CACHE-FETCH-STRATEGY': 'NETWORK_ONLY',
      'X-APOLLO-EXPIRE-TIMEOUT': '0',
      'X-APOLLO-EXPIRE-AFTER-READ': 'false',
      'X-APOLLO-PREFETCH': 'false',
      'X-APOLLO-CACHE-DO-NOT-STORE': 'false',
      'X-PX-AUTHORIZATION': '3',
      'X-PX-ORIGINAL-TOKEN': '3:6504b519945cfa980ac2cf49d14430e98c624c41ac9bda47e36c2946cb642a91:5/DWQxc4YozmWrPnhTM7ttFsnK2hv8wTGtajpVVCWfFaz+rkHh8Rdscrapk3FWz8ewYdSZOqU+PXXzydK5Dqpg==:1000:DlvoClCSrIl+tlxGoOabAMOS44TwhqX/8ANg7v5TOiMg9Yrwg8cT5sIc7n9RePeB1RZX3lHHlRARxBA+M3JZs0/0InLefEI4/MOLG8lUuov3BEbOrd/gA/V1AuwWz2ar4YXttSLrDjEbtygANkgB6JT8lvV8K00O4lIs6dh+rTiE7NtAX6TBLaUDSjqK9PvdBFvq+IEHler2O+88NSZfhA==',
      'x-o-market': 'US',
      'x-o-segment': 'oaoh',
      'x-o-platform': 'android',
      'x-o-platform-version': '21.27',
      'x-wm-sid': '184235ae-b7d1-4b5e-bde4-3e615d1e5084',
      'x-wm-vid': '5e138803-a6f5-4a59-8059-b2decd53dd75',
      'WM_MP': 'true',
      'x-o-fuzzy-install-date': '1639200000000',
      'x-enable-server-timing': '1',
      'x-latency-trace': '1',
      'device_profile_ref_id': '2d563d5ec15908d536cb5708eb26e884',
      'Content-Type': 'application/json; charset=utf-8',
      'Host': 'www.walmart.com',
      'Connection': 'Keep-Alive',
      'Accept-Encoding': 'gzip',
      'Cookie': 'ACID=32080f12-aaaa-484d-88ea-2706a087e189; _pxhd=Wa3BhDPPfHQvMwMMH71HGpmmNHP35Xa/MM0rTuThUBDoTQUHgtb0VvgluzuI6NQgzM9ZFpLfCrBjfXLSYnGHaA==:r0t/L0KgFf/j1OCofd9anC6iw6Fn-OK6aH9JPFI9ZN/9QtkKv9xHqwQg3oypDBkpVg9H6uIZiJg3gwDNIpt4-UtrHjIlYsX8WOTp7wCqliI=; hasACID=true; TB_DC_Flap_Test=0; TB_Navigation_Preload_01=1; TB_Latency_Tracker_100=1; ak_bmsc=DD577270F3304F7688C6719B3BD8A765~000000000000000000000000000000~YAAQ2RBFdsTeUrJ9AQAAJf2xsg4DuBsL6mvuQpgoZhLga7D3rGvoby6K6EcxfwtRaX42E2sGOphGtbomrjBWWKWwVms4PZQpne8GzQdLXy7+VBtcHe6Ell+kIz1Ww+w/cNaGy429oSJqcr1ebuPHRNh72YW8zEej4icJd6B9gE4bqUtv88tYSfx9c3PLhDVWDpRJxvIti65HT7kMddJeTxHZBqdJ+czGLQdrLNQlDIEV3rhPXDN0IcjDBpFy60JmgocQMQFMDb8ajIEogOgU3POU05dFu9FeSvXf+Eh79hwnHKsxYole9eudsjw40kUCeDdwjJaZE6qPd4ZUgRWFYVnDA2YWCJT167RIyEtWaBo+ph3LmS/mB8WxojajCA==; auth=MTAyOTYyMDE488Sn0Q%2FgTHQPLWYy4E4EB1f%2Bvg4O65OM1Ec0y9JHVNg5YwbG%2BrpWiRso2gcboPXNjQRFeUGCmxvQhoohhoxnPi34Os%2BvLgwiv5J5QT1z5ctc2oCqyXD%2BRlub3NXn8otU767wuZloTfhm7Wk2Kcjygiq0nmGVz3wI1IrcfVbuZ17Za%2BLi5wUU81YEjX8wMob8qtQc1b30gVIjc1bZ3OYNLuq5FxQsEHIWmynv3A%2BdPU0UMk70P8glgOEpLOprhDfMywI05adPtwc9%2Fm5r1ONHR82CgwXb7WUX5ZHFt3uAi%2FsCjUnLuTocFSGY8rBaG%2BDcqHcVVaWE%2B%2Ffn3NCyLo9D5fT9gW8xbrYSempHJ4sCLDoZwGmeox1DJzAge0TpUfxE7qf8X8bDAJo7Qssn6uM2Y0jyrOXbKKhH072NS%2FW0j%2FU%3D; xpm=-2%2B1639381786%2B%2B; xpa=CpYc4|Vwt1Y; akavpau_p1=1639382386~id=be00261dcb013eaeb011fd256d39826e; xpdtc=1; locDataV3=eyJpbnRlbnQiOiJTSElQUElORyIsInBpY2t1cCI6W3siYnVJZCI6IjAiLCJub2RlSWQiOiIzMTgwIiwiZGlzcGxheU5hbWUiOiJTb3V0aCBHYXRlIFN1cGVyY2VudGVyIiwibm9kZVR5cGUiOiJTVE9SRSIsImFkZHJlc3MiOnsicG9zdGFsQ29kZSI6IjkwMjgwIiwiYWRkcmVzc0xpbmUxIjoiNDY1MSBGaXJlc3RvbmUgQmx2ZCIsImNpdHkiOiJTb3V0aCBHYXRlIiwic3RhdGUiOiJDQSIsImNvdW50cnkiOiJVUyIsInBvc3RhbENvZGU5IjoiOTAyODAtMDAwMCJ9LCJnZW9Qb2ludCI6eyJsYXRpdHVkZSI6MzMuOTU0ODM4LCJsb25naXR1ZGUiOi0xMTguMTg3NTUzfSwiaXNHbGFzc0VuYWJsZWQiOnRydWUsInNjaGVkdWxlZEVuYWJsZWQiOnRydWUsInVuU2NoZWR1bGVkRW5hYmxlZCI6dHJ1ZX1dLCJkZWxpdmVyeSI6eyJidUlkIjoiMCIsIm5vZGVJZCI6IjMxODAiLCJkaXNwbGF5TmFtZSI6IlNvdXRoIEdhdGUgU3VwZXJjZW50ZXIiLCJub2RlVHlwZSI6IlNUT1JFIiwiYWRkcmVzcyI6eyJwb3N0YWxDb2RlIjoiOTAyODAiLCJhZGRyZXNzTGluZTEiOiI0NjUxIEZpcmVzdG9uZSBCbHZkIiwiY2l0eSI6IlNvdXRoIEdhdGUiLCJzdGF0ZSI6IkNBIiwiY291bnRyeSI6IlVTIiwicG9zdGFsQ29kZTkiOiI5MDI4MC0wMDAwIn0sImdlb1BvaW50Ijp7ImxhdGl0dWRlIjozMy45NTQ4MzgsImxvbmdpdHVkZSI6LTExOC4xODc1NTN9LCJpc0dsYXNzRW5hYmxlZCI6dHJ1ZSwic2NoZWR1bGVkRW5hYmxlZCI6dHJ1ZSwidW5TY2hlZHVsZWRFbmFibGVkIjp0cnVlLCJhY2Nlc3NQb2ludHMiOlt7ImFjY2Vzc1R5cGUiOiJERUxJVkVSWV9BRERSRVNTIn1dfSwic2hpcHBpbmdBZGRyZXNzIjp7ImxhdGl0dWRlIjozMy45NzI4LCJsb25naXR1ZGUiOi0xMTguMjQ4MiwicG9zdGFsQ29kZSI6IjkwMDAxIiwiY2l0eSI6IkxvcyBBbmdlbGVzIiwic3RhdGUiOiJDQSIsImNvdW50cnlDb2RlIjoiVVNBIiwiZ2lmdEFkZHJlc3MiOmZhbHNlfSwiYXNzb3J0bWVudCI6eyJub2RlSWQiOiIzMTgwIiwiZGlzcGxheU5hbWUiOiJTb3V0aCBHYXRlIFN1cGVyY2VudGVyIiwiYWNjZXNzUG9pbnRzIjpudWxsLCJpbnRlbnQiOiJQSUNLVVAiLCJzY2hlZHVsZUVuYWJsZWQiOmZhbHNlfSwiaW5zdG9yZSI6ZmFsc2UsInJlZnJlc2hBdCI6MTYzOTQwNDg2MTUzNCwidmFsaWRhdGVLZXkiOiJwcm9kOnYyOjMyMDgwZjEyLWFhYWEtNDg0ZC04OGVhLTI3MDZhMDg3ZTE4OSJ9; assortmentStoreId=3180; locGuestData=eyJpbnRlbnQiOiJTSElQUElORyIsInN0b3JlSW50ZW50IjoiUElDS1VQIiwibWVyZ2VGbGFnIjpmYWxzZSwicGlja3VwIjp7Im5vZGVJZCI6IjMxODAiLCJ0aW1lc3RhbXAiOjE2MzkyMjczODcwNDB9LCJwb3N0YWxDb2RlIjp7InRpbWVzdGFtcCI6MTYzOTIyNzM4NzA0MCwiYmFzZSI6IjkwMDAxIn0sInZhbGlkYXRlS2V5IjoicHJvZDp2MjozMjA4MGYxMi1hYWFhLTQ4NGQtODhlYS0yNzA2YTA4N2UxODkifQ%3D%3D; TB_SFOU-100=; hasLocData=1; vtc=a4MiaqoaFlg3lLtw34Ocn8; bstc=ZB1V4yUsfBPV9ZAVTDlAN0; mobileweb=1; xptwg=73988351:186061A4E9D16B0:3FDCF95:FABCAAB6:793964C:22913BFE:; TBWL-94-sbGQLSRL=cge0v5ahjhsw:0:1klvz12y5737d:2qrkct841jjfp; TS01b0be75=01503b2d70de56ed61ec1a885617908f930e548d64f29d825aa9c3e565265f1bfc74721b5db58585fc2c4a18473ce5d325c36fcde4; TS013ed49a=01503b2d70de56ed61ec1a885617908f930e548d64f29d825aa9c3e565265f1bfc74721b5db58585fc2c4a18473ce5d325c36fcde4; akavpau_p2=1639383862~id=4c016bef2fda555cae8a2af35b68d25a; bm_sv=7A5AD81E463966C8935E191D42EB4E7A~bOsJ5c4cbY/lUOMgi/6J9jZRuGR2yt6w3OQkNjzKDFi5md1vdMAdhslyp7oBeAvZq7P2a9SFgOjh2WGUZka7DvI5KUvvM0GOo9CXnntixVqYQdaIcyJvPpnLXjKeCt9TvDsSBHcJvc36DGvCs8mYknqowj2cn2gmZvrwvKghj4E=; TB_SFOU-100=; TS013ed49a=01538efd7c03c2e457fb02fccf7bbd3f96ccd220bb2e79d149393371544c0710bc398dfae07c4ec8386de85f29e325aee3f7545d0f; assortmentStoreId=3180; bstc=ZB1V4yUsfBPV9ZAVTDlAN0; hasLocData=1; locDataV3=eyJpbnRlbnQiOiJTSElQUElORyIsInBpY2t1cCI6W3siYnVJZCI6IjAiLCJub2RlSWQiOiIzMTgwIiwiZGlzcGxheU5hbWUiOiJTb3V0aCBHYXRlIFN1cGVyY2VudGVyIiwibm9kZVR5cGUiOiJTVE9SRSIsImFkZHJlc3MiOnsicG9zdGFsQ29kZSI6IjkwMjgwIiwiYWRkcmVzc0xpbmUxIjoiNDY1MSBGaXJlc3RvbmUgQmx2ZCIsImNpdHkiOiJTb3V0aCBHYXRlIiwic3RhdGUiOiJDQSIsImNvdW50cnkiOiJVUyIsInBvc3RhbENvZGU5IjoiOTAyODAtMDAwMCJ9LCJnZW9Qb2ludCI6eyJsYXRpdHVkZSI6MzMuOTU0ODM4LCJsb25naXR1ZGUiOi0xMTguMTg3NTUzfSwiaXNHbGFzc0VuYWJsZWQiOnRydWUsInNjaGVkdWxlZEVuYWJsZWQiOnRydWUsInVuU2NoZWR1bGVkRW5hYmxlZCI6dHJ1ZX1dLCJkZWxpdmVyeSI6eyJidUlkIjoiMCIsIm5vZGVJZCI6IjMxODAiLCJkaXNwbGF5TmFtZSI6IlNvdXRoIEdhdGUgU3VwZXJjZW50ZXIiLCJub2RlVHlwZSI6IlNUT1JFIiwiYWRkcmVzcyI6eyJwb3N0YWxDb2RlIjoiOTAyODAiLCJhZGRyZXNzTGluZTEiOiI0NjUxIEZpcmVzdG9uZSBCbHZkIiwiY2l0eSI6IlNvdXRoIEdhdGUiLCJzdGF0ZSI6IkNBIiwiY291bnRyeSI6IlVTIiwicG9zdGFsQ29kZTkiOiI5MDI4MC0wMDAwIn0sImdlb1BvaW50Ijp7ImxhdGl0dWRlIjozMy45NTQ4MzgsImxvbmdpdHVkZSI6LTExOC4xODc1NTN9LCJpc0dsYXNzRW5hYmxlZCI6dHJ1ZSwic2NoZWR1bGVkRW5hYmxlZCI6dHJ1ZSwidW5TY2hlZHVsZWRFbmFibGVkIjp0cnVlLCJhY2Nlc3NQb2ludHMiOlt7ImFjY2Vzc1R5cGUiOiJERUxJVkVSWV9BRERSRVNTIn1dfSwic2hpcHBpbmdBZGRyZXNzIjp7ImxhdGl0dWRlIjozMy45NzI4LCJsb25naXR1ZGUiOi0xMTguMjQ4MiwicG9zdGFsQ29kZSI6IjkwMDAxIiwiY2l0eSI6IkxvcyBBbmdlbGVzIiwic3RhdGUiOiJDQSIsImNvdW50cnlDb2RlIjoiVVNBIiwiZ2lmdEFkZHJlc3MiOmZhbHNlfSwiYXNzb3J0bWVudCI6eyJub2RlSWQiOiIzMTgwIiwiZGlzcGxheU5hbWUiOiJTb3V0aCBHYXRlIFN1cGVyY2VudGVyIiwiYWNjZXNzUG9pbnRzIjpudWxsLCJpbnRlbnQiOiJQSUNLVVAiLCJzY2hlZHVsZUVuYWJsZWQiOmZhbHNlfSwiaW5zdG9yZSI6ZmFsc2UsInJlZnJlc2hBdCI6MTYzOTUyMjE3MjYzMiwidmFsaWRhdGVLZXkiOiJwcm9kOnYyOjMyMDgwZjEyLWFhYWEtNDg0ZC04OGVhLTI3MDZhMDg3ZTE4OSJ9; locGuestData=eyJpbnRlbnQiOiJTSElQUElORyIsInN0b3JlSW50ZW50IjoiUElDS1VQIiwibWVyZ2VGbGFnIjpmYWxzZSwicGlja3VwIjp7Im5vZGVJZCI6IjMxODAiLCJ0aW1lc3RhbXAiOjE2MzkyMjczODcwNDB9LCJwb3N0YWxDb2RlIjp7InRpbWVzdGFtcCI6MTYzOTIyNzM4NzA0MCwiYmFzZSI6IjkwMDAxIn0sInZhbGlkYXRlS2V5IjoicHJvZDp2MjozMjA4MGYxMi1hYWFhLTQ4NGQtODhlYS0yNzA2YTA4N2UxODkifQ%3D%3D; mobileweb=0; vtc=a4MiaqoaFlg3lLtw34Ocn8; xprkg=1; xptwg=1295179437:B5C77942122788:1DC3407:E41CFF53:EE71096D:FF0BBA33:; TS01b0be75=01538efd7c565f3161ce7fac2322ab77595e41405e03ccc4fcf1f0f96cf4e73af0fd12d455c84fa2cbd5e76f4c9bed1ee0aa0c0f81; _pxhd=v3y2vmq/SBA9DkinXvcpL2aRF8CqiogdrPub8IwmumIViIXG/iIfGl0ghRs5TEldJO7bEvaAo54-8HNqqul95Q==:vHpFAQKr1MW4one2nZRPeYzQUntOB53zvXmQ7gL4JT3TxAZDk3jZOcrH0cua1DDHrdDqZEDjxrZT1PS/YHNGJN053p1jXJBWVbWXcDuFnPI=; akavpau_p2=1639501639~id=9ab6ca70905a69d3efe264bc85b48783',
      'User-Agent': 'WMT1H/21.27 Android/7.1.2',
      'Postman-Token': '54f7fa96-7bf6-4fcc-b5d0-eb7337df6fbb',
      'Content-Length': '22863',
    };

    const res = await this.httpService.post(url, JSON.stringify(body), { headers }).toPromise();
    this.logger.log('Product res: ', res.data);
    //save product to file
    const product = new Walmart();
    product.productNo = '01';
    product.name = 'product 01';
    await this.store(Buffer.from(JSON.stringify(res.data), 'utf-8'), 'json');
    return WalmartMapper.fromEntityToDTO(product);
  }

  async searching(q: string): Promise<WalmartDTO[]> {
    return null;
  }

  async category(url: string): Promise<WalmartDTO[]> {
    return null;
  }

  async store(content: Buffer, extension: string): Promise<string> {
    const id = uuid();
    const url = await this.fileService.store([RETAILER], id, extension, content);
    return id;
  }


}
